#!/usr/bin/env python
# -*- coding: utf-8 -*-

import argparse
import logging

from twitchcancer.config import Config
from twitchcancer.utils.logging import setup_logger

logger = logging.getLogger('twitchcancer')

if __name__ == "__main__":
    # persist data generated by monitor
    parser = argparse.ArgumentParser()
    parser.add_argument('--log', dest='loglevel',
                        help="set the level of messages to display")
    parser.add_argument('-f', '--config', dest='config',
                        help="load configuration from this file")
    parser.add_argument('--viewers', dest='viewers', default=0, type=int,
                        help="minimum viewer count to monitor channels (default: 0)")
    parser.add_argument("--protocol", dest="protocol", default="irc",
                        help="protocol to use to monitor chat channels, websocket or irc (default: websocket)")

    args = parser.parse_args()
    if args.config:
        Config.load(args.config)
    setup_logger(logger, args.loglevel, Config, "monitor.log")

    # start monitoring forever
    from twitchcancer.chat.chat import run

    run(args)
