#!/usr/bin/env python
# -*- coding: utf-8 -*-

import argparse
import logging
logger = logging.getLogger('twitchcancer')

from twitchcancer.config import Config
from twitchcancer.utils.logging import setup_logger
from twitchcancer.chat.chat import run

if __name__ == "__main__":
  parser = argparse.ArgumentParser()
  # persist data generated by monitor

  parser.add_argument('--log', dest='loglevel',
    help="set the level of messages to display")

  parser.add_argument('-f', '--config', dest='config',
    help="load configuration from this file")

  parser.add_argument('--viewers', dest='viewers', default=1000, type=int,
    help="minimum viewer count to monitor channels (default: 1000)")

  parser.add_argument("--protocol", dest="protocol", default="irc",
    help="protocol to use to monitor chat channels, websocket or irc (default: irc)")

  args = parser.parse_args()

  # load the config
  if args.config:
    Config.load(args.config)

  # set the logging stack up
  setup_logger(logger, args.loglevel, Config, "monitor.log")

  # start recording forever
  run(args)

